import React, { useState, useEffect } from 'react'
import { useSearchParams } from 'react-router-dom'
import ProductCard from '../components/ProductCard'
import { ProductGridSkeleton } from '../components/ProductSkeleton'
import ProductSearch from '../components/Search'

const products = [
  {
    id: 1,
    name: 'Pijama de Seda Premium',
    description: 'Confortável e elegante para noites especiais',
    fullDescription: 'Pijama de seda natural 100%, extremamente confortável e elegante. Ideal para noites de sono tranquilo. Feito com materiais de alta qualidade que proporcionam suavidade e durabilidade.',
    price: 129.90,
    originalPrice: 159.90,
    image: 'https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=500',
    sizes: ['P', 'M', 'G', 'GG'],
    colors: ['Rosa', 'Azul', 'Preto', 'Branco'],
    rating: 5,
    reviews: 128,
    isNew: true,
    category: 'premium',
    tags: ['seda', 'elegante', 'premium']
  },
  {
    id: 2,
    name: 'Pijama Algodão Estampado',
    description: 'Suave, respirável e com estampas divertidas',
    fullDescription: 'Pijama 100% algodão egípcio com estampas exclusivas. Perfeito para o dia a dia, oferecendo conforto máximo e estilo. Material respirável que se adapta à temperatura corporal.',
    price: 79.90,
    image: 'https://images.unsplash.com/photo-1581259097746-85d9c3d5f3e7?w=500',
    sizes: ['P', 'M', 'G'],
    colors: ['Branco', 'Azul', 'Verde', 'Amarelo'],
    rating: 4,
    reviews: 89,
    isNew: false,
    category: 'algodao',
    tags: ['algodão', 'estampado', 'conforto']
  },
  {
    id: 3,
    name: 'Conjunto Pijama Inverno',
    description: 'Aconchegante e quentinho para o frio',
    fullDescription: 'Conjunto de pijama especialmente desenvolvido para o inverno, com tecido fleece super aconchegante. Mantém o calor corporal durante as noites mais frias sem perder o estilo.',
    price: 149.90,
    image: 'https://images.unsplash.com/photo-1577906096429-f73c2c312435?w=500',
    sizes: ['M', 'G', 'GG', 'XG'],
    colors: ['Cinza', 'Vermelho', 'Azul Marinho', 'Verde Escuro'],
    rating: 5,
    reviews: 156,
    isNew: true,
    category: 'inverno',
    tags: ['inverno', 'aconchegante', 'frio']
  },
  {
    id: 4,
    name: 'Camisola Longa Elegante',
    description: 'Sophisticada e confortável para ocasiões especiais',
    fullDescription: 'Camisola longa em viscose de bambu, perfeita para quem busca elegância e conforto. Caimento perfeito e textura suave que proporciona uma experiência única de conforto.',
    price: 99.90,
    originalPrice: 119.90,
    image: 'https://images.unsplash.com/photo-1594032198267-e6afcb5a1dad?w=500',
    sizes: ['P', 'M', 'G'],
    colors: ['Preto', 'Branco', 'Vermelho', 'Azul Royal'],
    rating: 4,
    reviews: 203,
    isNew: false,
    category: 'camisola',
    tags: ['camisola', 'elegante', 'longa']
  },
  {
    id: 5,
    name: 'Pijama Short Verão',
    description: 'Fresquinho e leve para noites quentes',
    fullDescription: 'Conjunto de pijama shorts perfeito para o verão. Feito em algodão leve e respirável, proporciona máximo conforto durante as noites mais quentes do ano.',
    price: 69.90,
    image: 'https://images.unsplash.com/photo-1581259097746-85d9c3d5f3e7?w=500',
    sizes: ['P', 'M', 'G', 'GG'],
    colors: ['Azul Claro', 'Rosa', 'Branco', 'Verde Claro'],
    rating: 4,
    reviews: 67,
    isNew: true,
    category: 'verao',
    tags: ['verão', 'short', 'leve']
  },
  {
    id: 6,
    name: 'Pijama Família',
    description: 'Conjunto familiar matching para todos',
    fullDescription: 'Coleção especial de pijamas matching para toda a família. Mesmo estilo e conforto para adultos e crianças, perfeito para momentos especiais em família.',
    price: 199.90,
    originalPrice: 249.90,
    image: 'https://images.unsplash.com/photo-1577906096429-f73c2c312435?w=500',
    sizes: ['Infantil P', 'Infantil M', 'Adulto P', 'Adulto M', 'Adulto G'],
    colors: ['Azul Marinho', 'Vermelho', 'Verde', 'Rosa'],
    rating: 5,
    reviews: 312,
    isNew: true,
    category: 'familia',
    tags: ['família', 'matching', 'conjunto']
  }
]

const Home = ({ onAddToCart, user, onLoginClick }) => {
  const [isLoading, setIsLoading] = useState(true)
  const [filter, setFilter] = useState('all')
  const [sort, setSort] = useState('name')
  const [searchQuery, setSearchQuery] = useState('')
  const [searchParams, setSearchParams] = useSearchParams()

  useEffect(() => {
    const timer = setTimeout(() => setIsLoading(false), 2000)
    return () => clearTimeout(timer)
  }, [])

  // Process search from URL
  useEffect(() => {
    const query = searchParams.get('q')
    if (query) {
      setSearchQuery(query)
    }
  }, [searchParams])

  const filteredProducts = products
    .filter(product => {
      // Filter by category
      if (filter === 'new' && !product.isNew) return false
      if (filter === 'sale' && !product.originalPrice) return false
      if (filter === 'premium' && product.category !== 'premium') return false
      if (filter === 'inverno' && product.category !== 'inverno') return false
      if (filter === 'verao' && product.category !== 'verao') return false

      // Search filter
      if (searchQuery) {
        const query = searchQuery.toLowerCase()
        return (
          product.name.toLowerCase().includes(query) ||
          product.description.toLowerCase().includes(query) ||
          product.tags.some(tag => tag.toLowerCase().includes(query))
        )
      }

      return true
    })
    .sort((a, b) => {
      if (sort === 'price') return a.price - b.price
      if (sort === 'price-desc') return b.price - a.price
      if (sort === 'rating') return b.rating - a.rating
      if (sort === 'new') return b.isNew - a.isNew
      return a.name.localeCompare(b.name)
    })

  const handleSearch = (query) => {
    setSearchQuery(query)
    if (query) {
      setSearchParams({ q: query })
    } else {
      setSearchParams({})
    }
  }

  const clearFilters = () => {
    setFilter('all')
    setSort('name')
    setSearchQuery('')
    setSearchParams({})
  }

  const activeFiltersCount = [filter !== 'all', sort !== 'name', searchQuery].filter(Boolean).length

  return (
    <div className="animate-fade-in">
      {/* Hero Section */}
      <section className="relative bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 py-24 overflow-hidden">
        <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-gray-200/30 via-transparent to-transparent dark:from-gray-700/20"></div>
        <div className="absolute top-10 right-10 w-72 h-72 bg-gradient-to-br from-gray-300/20 to-gray-400/10 dark:from-gray-600/20 dark:to-gray-700/10 rounded-full blur-3xl"></div>
        <div className="absolute bottom-10 left-10 w-96 h-96 bg-gradient-to-tr from-gray-200/20 to-gray-300/10 dark:from-gray-600/20 dark:to-gray-700/10 rounded-full blur-3xl"></div>
        
        <div className="container mx-auto px-4 text-center relative z-10">
          <div className="max-w-5xl mx-auto">
            <div className="inline-flex items-center space-x-2 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl px-6 py-3 mb-8 shadow-lg">
              <span className="w-2 h-2 bg-gradient-to-r from-gray-700 to-gray-900 dark:from-gray-300 dark:to-gray-100 rounded-full animate-pulse"></span>
              <span className="text-sm font-semibold text-gray-700 dark:text-gray-300">✨ Coleção Outono/Inverno 2024</span>
            </div>

            <h1 className="text-5xl md:text-7xl font-bold mb-6 animate-fade-in leading-tight">
              Conforto que <span className="bg-gradient-to-r from-gray-700 to-gray-900 dark:from-gray-300 dark:to-gray-100 bg-clip-text text-transparent">Transforma</span> suas Noites
            </h1>
            <p className="text-xl md:text-2xl text-gray-600 dark:text-gray-400 mb-10 leading-relaxed max-w-3xl mx-auto animate-fade-in" style={{animationDelay: '0.2s'}}>
              Descubra pijamas premium que combinam <span className="font-semibold text-gray-800 dark:text-white">elegância, conforto</span> e qualidade excepcional para noites perfeitas de descanso.
            </p>
            <div className="animate-fade-in" style={{animationDelay: '0.4s'}}>
              <button className="group bg-gradient-to-r from-gray-700 to-gray-900 dark:from-gray-300 dark:to-gray-100 text-white dark:text-gray-900 px-12 py-5 rounded-2xl text-lg font-semibold hover:shadow-2xl transform hover:scale-105 transition-all duration-300 shadow-xl flex items-center space-x-4 mx-auto">
                <i className="fas fa-gem text-yellow-200 dark:text-yellow-600 group-hover:rotate-180 transition-transform duration-500"></i>
                <span>Descobrir Coleção</span>
                <i className="fas fa-arrow-right group-hover:translate-x-2 transition-transform duration-300"></i>
              </button>
            </div>

            {/* Stats */}
            <div className="grid grid-cols-3 gap-8 mt-16 max-w-2xl mx-auto animate-fade-in" style={{animationDelay: '0.6s'}}>
              <div className="text-center">
                <div className="text-3xl font-bold text-gray-800 dark:text-white">2K+</div>
                <div className="text-gray-600 dark:text-gray-400 text-sm">Clientes Satisfeitos</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-gray-800 dark:text-white">4.9</div>
                <div className="text-gray-600 dark:text-gray-400 text-sm">Avaliação Média</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-gray-800 dark:text-white">24h</div>
                <div className="text-gray-600 dark:text-gray-400 text-sm">Entrega Expressa</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Features */}
      <section className="py-16 bg-white dark:bg-gray-800">
        <div className="container mx-auto px-4">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
            <div className="animate-fade-in" style={{animationDelay: '0.1s'}}>
              <div className="bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-2xl w-20 h-20 flex items-center justify-center mx-auto mb-4 shadow-lg">
                <i className="fas fa-truck text-gray-700 dark:text-gray-300 text-2xl"></i>
              </div>
              <h3 className="font-bold text-xl mb-2 text-gray-800 dark:text-white">Frete Grátis</h3>
              <p className="text-gray-600 dark:text-gray-400">Em compras acima de R$ 150</p>
            </div>
            <div className="animate-fade-in" style={{animationDelay: '0.3s'}}>
              <div className="bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-2xl w-20 h-20 flex items-center justify-center mx-auto mb-4 shadow-lg">
                <i className="fas fa-shield-alt text-gray-700 dark:text-gray-300 text-2xl"></i>
              </div>
              <h3 className="font-bold text-xl mb-2 text-gray-800 dark:text-white">Garantia</h3>
              <p className="text-gray-600 dark:text-gray-400">30 dias de satisfação garantida</p>
            </div>
            <div className="animate-fade-in" style={{animationDelay: '0.5s'}}>
              <div className="bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-2xl w-20 h-20 flex items-center justify-center mx-auto mb-4 shadow-lg">
                <i className="fas fa-credit-card text-gray-700 dark:text-gray-300 text-2xl"></i>
              </div>
              <h3 className="font-bold text-xl mb-2 text-gray-800 dark:text-white">Parcele</h3>
              <p className="text-gray-600 dark:text-gray-400">Em até 12x sem juros</p>
            </div>
          </div>
        </div>
      </section>

      {/* Products Section */}
      <section className="py-16 bg-gradient-to-b from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800">
        <div className="container mx-auto px-4">
          <div className="text-center mb-12">
            <h2 className="text-4xl font-bold text-gray-800 dark:text-white mb-4">Coleção Exclusiva</h2>
            <p className="text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
              Descubra pijamas que combinam estilo, conforto e qualidade premium em cada detalhe
            </p>
          </div>

          {/* Search and Filters */}
          <div className="mb-8 space-y-4">
            <ProductSearch onSearch={handleSearch} initialQuery={searchQuery} />
            
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
              <div className="flex flex-wrap gap-2">
                <button 
                  onClick={() => setFilter('all')}
                  className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                    filter === 'all' 
                      ? 'bg-gray-800 dark:bg-gray-300 text-white dark:text-gray-900' 
                      : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                  }`}
                >
                  Todos
                </button>
                <button 
                  onClick={() => setFilter('new')}
                  className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                    filter === 'new' 
                      ? 'bg-gray-800 dark:bg-gray-300 text-white dark:text-gray-900' 
                      : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                  }`}
                >
                  Novidades
                </button>
                <button 
                  onClick={() => setFilter('sale')}
                  className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                    filter === 'sale' 
                      ? 'bg-gray-800 dark:bg-gray-300 text-white dark:text-gray-900' 
                      : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                  }`}
                >
                  Promoções
                </button>
                <button 
                  onClick={() => setFilter('premium')}
                  className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                    filter === 'premium' 
                      ? 'bg-gray-800 dark:bg-gray-300 text-white dark:text-gray-900' 
                      : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                  }`}
                >
                  Premium
                </button>
              </div>
              
              <div className="flex items-center gap-3">
                {activeFiltersCount > 0 && (
                  <button 
                    onClick={clearFilters}
                    className="text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 transition-colors"
                  >
                    Limpar ({activeFiltersCount})
                  </button>
                )}
                <select 
                  value={sort}
                  onChange={(e) => setSort(e.target.value)}
                  className="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800 dark:focus:ring-gray-300 text-gray-700 dark:text-gray-300"
                >
                  <option value="name">Ordenar: Nome</option>
                  <option value="price">Ordenar: Menor Preço</option>
                  <option value="price-desc">Ordenar: Maior Preço</option>
                  <option value="rating">Ordenar: Melhor Avaliado</option>
                  <option value="new">Ordenar: Novidades</option>
                </select>
              </div>
            </div>

            {/* Results Info */}
            <div className="text-sm text-gray-600 dark:text-gray-400">
              {filteredProducts.length} {filteredProducts.length === 1 ? 'produto encontrado' : 'produtos encontrados'}
              {searchQuery && ` para "${searchQuery}"`}
            </div>
          </div>

          {isLoading ? (
            <ProductGridSkeleton count={6} />
          ) : filteredProducts.length === 0 ? (
            <div className="text-center py-12">
              <i className="fas fa-search text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
              <h3 className="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">
                Nenhum produto encontrado
              </h3>
              <p className="text-gray-500 dark:text-gray-500 mb-4">
                {searchQuery ? `Não encontramos resultados para "${searchQuery}"` : 'Tente ajustar os filtros para ver mais produtos'}
              </p>
              <button 
                onClick={clearFilters}
                className="btn-primary"
              >
                <i className="fas fa-times mr-2"></i>
                Limpar Filtros
              </button>
            </div>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
              {filteredProducts.map((product, index) => (
                <div 
                  key={product.id} 
                  className="animate-fade-in" 
                  style={{animationDelay: `${index * 0.1}s`}}
                >
                  <ProductCard 
                    product={product} 
                    onAddToCart={onAddToCart}
                    user={user}
                    onLoginClick={onLoginClick}
                  />
                </div>
              ))}
            </div>
          )}
        </div>
      </section>
    </div>
  )
}

export default Home